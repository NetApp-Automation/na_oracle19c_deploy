# ----------------------------------------------------------------------------------------------------------------------
# ----------------------------------------------------------------------------------------------------------------------
# Create Oracle database instance from template using dbca utility
# Create number of PDBs within the instance container as specified by user
# ----------------------------------------------------------------------------------------------------------------------
# ----------------------------------------------------------------------------------------------------------------------
- block:
    - name: Generate response file for dbca for single instance Oracle setup
      template:
        src: "dbca.rsp.{{ ora_version }}"
        dest: "{{ installation_folder }}/dbca.rsp"
      become: true
      become_user: '{{ oracle_user }}'

    - name: Create database for single Oracle instance
      command: "{{ oracle_home }}/bin/dbca -silent -createDatabase -responseFile {{ installation_folder }}/dbca.rsp"
      become: true
      become_user: '{{ oracle_user }}'
  rescue:
    - name: Failure message
      debug:
        msg:
          - "TASK [Create Oracle database] FAILED. Hints:"
          - 1. Check the failure error message.
          - 2. Check the error message in dbca log file on target hosts.
          - 2. Check whether the task file exists.
          - 3. Check whether the task file name and extension is correct.
  tags:
    - create_database
